{% import "_components.njk" as components %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta
    name="viewport" content="width=device-width, initial-scale=1.0"/>
    <!-- Basic SEO -->
    <title>{{ title }}
      {% if not isHomePage %}
        - ReadThis{% endif %}
    </title>
    <meta name="description" content="{{ description | default('Technical insights and best practices from experienced developers. Deep dives into system architecture, performance optimization, and engineering case studies.') }}"/>
    <meta
      name="keywords"
      content="technical blog, software development, {{ keywords | default('system architecture, engineering, development,
        programming') }}"/>
    <link rel="manifest" href="/manifest.json"/>
    <meta name="author" content="{{ author | default('Aiko Jansen, Senad Redzic') }}"/>
    <link rel="canonical" href="https://readthis.io/{{ slug }}"/>
    <meta property="og:type" content="{{ ogType | default('website') }}"/>
    <meta property="og:url" content="https://readthis.io/{{ slug }}"/>
    <meta property="og:title" content="{{ title }}{% if not isHomePage %} - ReadThis{% endif %}"/>
    <meta property="og:description" content="{{ description | default('Technical insights and best practices from experienced developers. Deep dives into system architecture, performance optimization, and engineering case studies.') }}"/>
    <meta property="og:image" content="https://readthis.io{{ featuredImage }}"/>
    <meta
    property="og:site_name" content="ReadThis"/> <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:url" content="https://readthis.io/{{ slug }}"/>
    <meta name="twitter:title" content="{{ title }}{% if not isHomePage %} - ReadThis{% endif %}"/>
    <meta name="twitter:description" content="{{ description | default('Technical insights and best practices from experienced developers. Deep dives into system architecture, performance optimization, and engineering case studies.') }}"/>
    <meta name="twitter:image" content="https://readthis.io{{ featuredImage }}"/>
    <meta
    name="twitter:creator" content="@readthis"/> <!-- Additional SEO -->
    <meta name="robots" content="index, follow"/>
    {% if readingTime %}
      <meta property="article:reading_time" content="{{ readingTime }}"/>
    {% endif %}
    {% if publishDate %}
      <meta property="article:published_time" content="{{ publishDate }}"/>
    {% endif %}
    {% if tags %}
      {% for tag in tags %}
        <meta property="article:tag" content="{{ tag }}"/>
      {% endfor %}
    {% endif %}
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon/favicon.ico"/>
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png"/>
    <link
    rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png"/>
    <!-- Styles -->
    {% for style in styles %}
      <link rel="stylesheet" href="{{ style }}"/>
    {% endfor %}
  </head>
  <body class="bg-white min-h-screen flex flex-col">
    <script>
      console.log("Hello from Before body")
    </script>
    <header class="bg-primary h-20">
      <div class="container mx-auto flex items-center space-x-6 justify-between h-full px-6">
        <div class="flex items-center h-16">
          <a href="/" class="flex items-center justify-center">
            <img srcset="readthis_logo.svg" alt="ReadThis Logo" width="180"/>
          </a>
        </div>
        <div class="flex items-center space-x-6">
          {{ components.secondaryButton("/about", "About") }}
          <a
            href="/contact"
            class="px-4 py-2 bg-transparent text-secondary border border-secondary rounded-sm hover:bg-secondary hover:text-white
              transition-colors">
            Contact
          </a>
        </div>
      </div>
    </header>
    <div
      class="container mx-auto px-6 flex flex-col md:flex-row gap-8 mt-6 flex-grow">
      <!-- Mobile Topics Dropdown -->
      <details class="md:hidden ">
        <summary class="w-full flex items-center justify-between px-4 py-2 bg-primary text-white rounded-sm cursor-pointer">
          <span class="font-mono">
            // Topics</span>
          <span class="transition-transform group-open:rotate-180 icon chevron w-4 h-4 bg-white"></span>
        </summary>
        <nav class="mt-2 bg-primary rounded-sm p-4">
          <ul class="space-y-2 font-mono">
            {% for category in categories %}
              <li>
                <a href="/category/{{ category.slug }}" class="flex items-center text-white hover:text-secondary transition-colors">
                  <span class="bg-secondary mr-2 icon arrow w-3 h-3"></span>
                  {{ category.category }}
                  <span class="ml-auto text-secondary">({{ category.count }})</span>
                </a>
              </li>
            {% endfor %}
          </ul>
        </nav>
      </details>
      <!-- Desktop Sidebar -->
      <nav class="hidden md:block md:w-64 shrink-0 sticky top-6   self-start">
        <div class="bg-gray-light border border-primary/5 backdrop-blur-sm rounded-md p-4">
          <div class="font-mono text-primary mb-4">// Topics</div>
          <ul class="space-y-3 font-mono">
            {% for category in categories %}
              <li>
                <a href="/category/{{ category.slug }}" class="flex items-center text-primary hover:text-secondary transition-colors">
                  <span class="bg-secondary mr-2 icon arrow w-4 h-4"></span>
                  {{ category.category }}
                  <span class="ml-auto text-primary">({{ category.count }})</span>
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      </nav>
      <!-- Main Content -->
      <main>
        {% block content %}{% endblock %}
      </main>
    </div>
    <footer class="bg-primary text-white mt-20 py-8  ">
      <div class="container mx-auto px-6">
        <div
          class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <!-- Company Links -->
          <div>
            <div class="font-mono text-secondary mb-6 text-lg">// Company</div>
            <ul class="space-y-2">
              <li>
                <a href="/about" class="text-white hover:text-secondary transition-colors">
                  About Us
                </a>
              </li>
              <li>
                <a href="/imprint" class="text-white hover:text-secondary transition-colors">
                  Imprint
                </a>
              </li>
              <li>
                <a href="/privacy" class="text-white hover:text-secondary transition-colors">
                  Data Privacy
                </a>
              </li>
            </ul>
          </div>
          <!-- Social Media -->
          <div>
            <div class="font-mono text-secondary mb-6 text-lg">// Connect</div>
            <div class="flex space-x-4">
              <a
                href="https://github.com/readthis-io"
                target="_blank"
                rel="noopener noreferrer"
                aria-label="Follow ReadThis on GitHub"
                class="text-white hover:text-secondary transition-colors">
                <span class="icon github w-6 h-6 bg-white" aria-hidden="true"></span>
                <span class="sr-only">GitHub</span>
              </a>
              <a
                href="https://linkedin.com/company/readthis-io"
                target="_blank"
                rel="noopener noreferrer"
                aria-label="Follow ReadThis on LinkedIn"
                class="text-white hover:text-secondary transition-colors">
                <span class="icon linkedin w-6 h-6 bg-white" aria-hidden="true"></span>
                <span class="sr-only">LinkedIn</span>
              </a>
            </div>
          </div>
          <!-- Copyright -->
          <div class="text-left md:text-right">
            <div class="font-mono text-secondary mb-6 text-lg">// ReadThis</div>
            <p class="text-white/70 text-sm">
              {{ generationTime }} <br/> Â© 2025 - {{ year }} ReadThis.io <br/> All rights reserved.
            </p>
          </div>
        </div>
      </div>
    </footer>
    {% for script in scripts %}
      <script src="{{ script }}"></script>
    {% endfor %}
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4T4C8RXX5T"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      // Set consent defaults
      gtag('consent', 'default', {
        analytics_storage: localStorage.getItem('silktideCookieChoice_analytics') === 'true'
          ? 'granted'
          : 'denied',
        ad_storage: localStorage.getItem('silktideCookieChoice_marketing') === 'true'
          ? 'granted'
          : 'denied',
        ad_user_data: localStorage.getItem('silktideCookieChoice_marketing') === 'true'
          ? 'granted'
          : 'denied',
        ad_personalization: localStorage.getItem('silktideCookieChoice_marketing') === 'true'
          ? 'granted'
          : 'denied',
        functionality_storage: localStorage.getItem('silktideCookieChoice_necessary') === 'true'
          ? 'granted'
          : 'denied',
        security_storage: localStorage.getItem('silktideCookieChoice_necessary') === 'true'
          ? 'granted'
          : 'denied'
      });
      gtag('js', new Date());
      gtag('config', 'G-4T4C8RXX5T');
      gtag("page", "{{ slug }}")
    </script>
    <script>
      silktideCookieBannerManager.updateCookieBannerConfig({
        background: {
          showBackground: true
        },
        cookieTypes: [
          {
            id: 'necessary',
            name: 'Essential',
            description: 'These keep read{this}.io working properly. They handle basic functions.',
            required: true
          }, {
            id: 'analytics',
            name: 'Analytics',
            description: 'We use Google Analytics to understand how people use our site. This helps us write better articles and fix issues.',
            required: false,
            onAccept: function () {
              gtag('consent', 'update', {'analytics_storage': 'granted'});
            },
            onReject: function () {
              gtag('consent', 'update', {'analytics_storage': 'denied'});
            }
          }, {
            id: 'external',
            name: 'Content',
            description: 'Allows us to show code examples, video tutorials, and other helpful resources from trusted sources like GitHub and YouTu' +
                'be.',
            required: false
          }
        ],
        text: {
          banner: {
            description: `<p class="text-primary/70">We believe in being transparent about data. Choose what you're comfortable sharing with us.</p>`,
            acceptAllButtonText: 'Accept All',
            rejectNonEssentialButtonText: 'Essential Only',
            preferencesButtonText: 'Customize'
          },
          preferences: {
            title: 'Your Privacy Choices',
            description: `<p class="text-primary/70">Control what data read{this}.io can use. Essential cookies can't be disabled as they keep the site working.</p>`
          }
        },
        position: {
          banner: 'bottomCenter',
          cookieIcon: 'bottomRight'
        }
      });
    </script>
  </body>
</html>